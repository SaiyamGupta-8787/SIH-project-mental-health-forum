<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Edit Profile</title>
  <style>
    body{font-family:Arial,Helvetica,sans-serif;margin:0;padding:18px;color:#222}
    .form-wrap{max-width:700px;margin:0 auto;background:#fff;padding:18px;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,.06)}
    label{display:block;margin-bottom:6px;font-weight:600}
    input,select{width:100%;padding:10px;margin-bottom:12px;border-radius:6px;border:1px solid #ccc}
    button{background:#0b74ff;color:#fff;padding:10px 14px;border:none;border-radius:6px;cursor:pointer}
  </style>
</head>
<body>
    {% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <div id="flash-messages">
      {% for category, message in messages %}
        <div class="flash flash-{{ category }}">{{ message }}</div>
      {% endfor %}
    </div>
  {% endif %}
{% endwith %}

<style>
.flash { padding:12px; margin:10px 0; border-radius:6px; font-weight:700; }
.flash-success { background:#d4edda; color:#155724; }
.flash-error { background:#f8d7da; color:#721c24; }
</style>

<script>
setTimeout(()=>{
  const f = document.getElementById('flash-messages');
  if(f){ f.style.transition = 'opacity .6s'; f.style.opacity = 0; setTimeout(()=>f.remove(),600); }
}, 3000);
</script>

  <div style="max-width:1100px;margin:0 auto">
    <p><a href="{{ url_for('view_profile', user_id=user.id) }}">&larr; Back to profile</a></p>

    <div class="form-wrap">
      <h2>Edit Profile</h2>
      <form method="POST" action="{{ url_for('edit_profile') }}">
        <label for="name">Display name (if not anonymous)</label>
        <input id="name" name="name" type="text" value="{{ user.name }}" placeholder="Username">

        <label for="college">College</label>
        <input id="college" name="college" type="text" value="{{ profile.college if profile else '' }}">

        <label for="year_of_study">Year of study</label>
        <input id="year_of_study" name="year_of_study" type="text" value="{{ profile.year_of_study if profile else '' }}">

        <label for="language_pref">Language</label>
        <select id="language_pref" name="language_pref">
          <option value="en" {% if profile and profile.language_pref == 'en' %}selected{% endif %}>English</option>
          <option value="hi" {% if profile and profile.language_pref == 'hi' %}selected{% endif %}>हिन्दी</option>
        </select>

        <label><input id="prefers_anonymous" name="prefers_anonymous" type="checkbox" {% if profile and profile.prefers_anonymous %}checked{% endif %}> Prefer to stay anonymous (hide name from others)</label>

        <div style="margin-top:12px">
          <button type="submit">Save profile</button>
          <a href="{{ url_for('view_profile', user_id=user.id) }}" style="margin-left:12px;">Cancel</a>
        </div>
      </form>
    </div>
  </div>

  <script>
    const checkbox = document.getElementById('prefers_anonymous');
    const nameInput = document.getElementById('name');
    function updateNameDisabled(){
      if(checkbox && checkbox.checked){ nameInput.disabled=true; nameInput.placeholder='Hidden while anonymous'; }
      else{ nameInput.disabled=false; nameInput.placeholder='Username'; }
    }
    if(checkbox){ checkbox.addEventListener('change', updateNameDisabled); updateNameDisabled(); }
  </script>
</body>
</html>
